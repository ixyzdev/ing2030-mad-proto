<!-- En public/vendor/potree/examples/viewer.html -->
<!-- SOLO modifica el script final: -->

<script type="module">
    // Obtener modelo desde parámetro URL
    const urlParams = new URLSearchParams(window.location.search);
    const modelToLoad = urlParams.get('model') || "../pointclouds/vol_total/cloud.js";
    const modelName = urlParams.get('name') || "Mi Modelo";

    window.viewer = new Potree.Viewer(document.getElementById("potree_render_area"));

    viewer.setEDLEnabled(false);
    viewer.setFOV(60);
    viewer.setPointBudget(1_000_000);
    viewer.loadSettingsFromURL();
    viewer.setBackground("skybox");

    viewer.loadGUI(() => {
        viewer.setLanguage('en');
        $("#menu_tools").next().show();
        $("#menu_clipping").next().show();
        viewer.toggleSidebar();
    });

    // Cargar el modelo dinámico
    Potree.loadPointCloud(modelToLoad, modelName, e => {
        let scene = viewer.scene;
        let pointcloud = e.pointcloud;

        let material = pointcloud.material;
        material.size = 1;
        material.pointSizeType = Potree.PointSizeType.ADAPTIVE;
        material.shape = Potree.PointShape.SQUARE;

        scene.addPointCloud(pointcloud);
        viewer.fitToScreen();
    });
</script>